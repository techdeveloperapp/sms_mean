{"version":3,"sources":["AdminComponents/streem/VideoStreem.js"],"names":["io","VideoStreem","users","setusers","useState","loadingData","setloadingData","stream","setStream","remoteStream","setRemoteStream","peerConnection","setPeerConnection","socket","useRef","localVideoRef","remoteVideoRef","restrictions","setrestrictions","Students","name","value","Academics","HR","Library","Finance","VideoStream","useEffect","current","pc","RTCPeerConnection","iceServers","urls","onicecandidate","event","candidate","emit","ontrack","streams","on","async","setRemoteDescription","RTCSessionDescription","data","answer","createAnswer","setLocalDescription","addIceCandidate","RTCIceCandidate","disconnect","srcObject","_jsx","children","_jsxs","ref","autoPlay","muted","onClick","navigator","mediaDevices","getUserMedia","video","audio","getTracks","forEach","track","addTrack","offer","createOffer"],"mappings":"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","file":"static/js/157.68058bff.chunk.js","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport axios from \"../../store/axios\";\nimport io from 'socket.io-client';\nimport SimplePeer from 'simple-peer';\n\nconst socket = io();\n\nfunction VideoStreem() {\n  const [users, setusers] = useState([]);\n  const [loadingData, setloadingData] = useState(false);\n\n  const [stream, setStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const [peerConnection, setPeerConnection] = useState(null);\n  const socket = useRef(null);\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n\n\n\n  const [restrictions, setrestrictions] = useState({\n    Students: [\n      { name: \"New Registration\", value: false },\n      { name: \"View Student Details\", value: false },\n      { name: \"Edit Student\", value: false },\n      { name: \"Student List\", value: false },\n      { name: \"Manage Scholarships\", value: false },\n      { name: \"Record Attendance\", value: false },\n      { name: \"Manage Section\", value: false },\n      { name: \"Manage Campuses\", value: false },\n      { name: \"Manage Dormitories\", value: false },\n      { name: \"Promotions/Demotions\", value: false },\n      { name: \"Prefects\", value: false },\n      { name: \"View Past Students\", value: false },\n      { name: \"View Withdrawn Students\", value: false },\n      { name: \"Delete Student\", value: false },\n      { name: \"Withdraw Student\", value: false },\n      { name: \"Re-enroll withdrawn Student\", value: false },\n    ],\n    Academics: [\n      { name: \"Manage Divisions\", value: false },\n      { name: \"Manage Classes\", value: false },\n      { name: \"Manage Subjects\", value: false },\n      { name: \"Manage Calendar\", value: false },\n      { name: \"Notes\", value: false },\n      { name: \"SBA\", value: false },\n      { name: \"Year Groups\", value: false },\n      { name: \"Terminal Reports\", value: false },\n      { name: \"Manage Letters / Correspondences\", value: false },\n    ],\n    HR: [\n      { name: \"Manage Departments\", value: false },\n      { name: \"Add Staff\", value: false },\n      { name: \"View Staff List/Details\", value: false },\n      { name: \"Edit Staff Details\", value: false },\n      { name: \"Staff Payroll\", value: false },\n      { name: \"PAYE Deductions\", value: false },\n      { name: \"Trustee\", value: false },\n      { name: \"SSNIT Contributions\", value: false },\n      { name: \"Staff Bank Details\", value: false },\n      { name: \"PAYE Calculator\", value: false },\n      { name: \"Delete/Archive Staff\", value: false },\n    ],\n    Library: [\n      { name: \"Books categories\", value: false },\n      { name: \"Books\", value: false },\n    ],\n    Finance: [\n      { name: \"View Set fees\", value: false },\n      { name: \"Set/Delete Fees\", value: false },\n      { name: \"Prepare Bill\", value: false },\n      { name: \"Bill Payment\", value: false },\n      { name: \"Initiate e-Payment Request\", value: false },\n      { name: \"Non-billable items payment\", value: false },\n      { name: \"View Payments\", value: false },\n      { name: \"Debtors Inventory module (View only)\", value: false },\n    ],\n    VideoStream: [\n        { name: \"View Set fees\", value: false },\n      ],\n  });\n\n  useEffect(() => {\n    setloadingData(true);\n    socket.current = io('https://toupgradeonlineapi.prekshaeyeyoga.com:8080');\n    const pc = new RTCPeerConnection({\n      iceServers: [\n        {\n          urls: 'stun:stun.l.google.com:19302',\n        },\n      ],\n    });\n\n    pc.onicecandidate = (event) => {\n      if (event.candidate) {\n        socket.current.emit('candidate', event.candidate);\n      }\n    };\n\n    pc.ontrack = (event) => {\n      setRemoteStream(event.streams[0]);\n    };\n\n    setPeerConnection(pc);\n\n    socket.current.on('offer', async (data) => {\n      await pc.setRemoteDescription(new RTCSessionDescription(data));\n      const answer = await pc.createAnswer();\n      await pc.setLocalDescription(answer);\n      socket.current.emit('answer', answer);\n    });\n\n    socket.current.on('answer', async (data) => {\n      await pc.setRemoteDescription(new RTCSessionDescription(data));\n    });\n\n    socket.current.on('candidate', async (data) => {\n      await pc.addIceCandidate(new RTCIceCandidate(data));\n    });\n\n    return () => {\n      socket.current.disconnect();\n    };\n  }, []);\n\n  const startVideo = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\n    setStream(stream);\n    localVideoRef.current.srcObject = stream;\n    stream.getTracks().forEach((track) => peerConnection.addTrack(track, stream));\n  };\n\n  const callUser = async () => {\n    const offer = await peerConnection.createOffer();\n    await peerConnection.setLocalDescription(offer);\n    socket.current.emit('offer', offer);\n  };\n\n  useEffect(() => {\n    if (remoteStream) {\n      remoteVideoRef.current.srcObject = remoteStream;\n    }\n  }, [remoteStream]);\n\n//   const handleCheckRole = (e, name) => {\n//     console.log(e, name);\n\n//     setrestrictions(\n//       Object.entries(restrictions).map((val, arr) =>\n//         val === e\n//           ? (restrictions[val] = arr.map((obj) =>\n//               obj.name === name ? { name, value: !obj.value } : obj\n//             ))\n//           : (restrictions[val] = arr)\n//       )\n//     );\n//   };\n\n  return (\n    <div>\n      {/* <div className=\" mb-5\">\n        {loadingData ? (\n          <>\n            <div className=\"d-flex justify-content-center content__container\">\n              <div className=\"spinner-border\" role=\"status\">\n                <span className=\"visually-hidden\">Loading...</span>\n              </div>\n            </div>\n          </>\n        ) : (\n            <h1>LLLLL</h1>\n        )}\n      </div> */}\n     <div>\n      <video ref={localVideoRef} autoPlay muted />\n      <video ref={remoteVideoRef} autoPlay />\n      <button onClick={startVideo}>Start Video</button>\n      <button onClick={callUser}>Call</button>\n    </div>\n    \n      \n    </div>\n  );\n}\n\nexport default VideoStreem;\n"],"sourceRoot":""}